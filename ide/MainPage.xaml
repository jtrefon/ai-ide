<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="ide.MainPage"
             x:FactoryMethod="Create">
    <ContentPage.MenuBarItems>
        <MenuBarItem Text="File">
            <MenuFlyoutItem Text="Open File…" Clicked="OnOpenFileMenuClicked">
                <MenuFlyoutItem.KeyboardAccelerators>
                    <KeyboardAccelerator Key="O" Modifiers="Windows" />
                </MenuFlyoutItem.KeyboardAccelerators>
            </MenuFlyoutItem>
            <MenuFlyoutItem Text="Open Project…" Clicked="OnOpenProjectMenuClicked">
                <MenuFlyoutItem.KeyboardAccelerators>
                    <KeyboardAccelerator Key="O" Modifiers="Command" />
                    <KeyboardAccelerator Key="O" Modifiers="Control" />
                </MenuFlyoutItem.KeyboardAccelerators>
            </MenuFlyoutItem>
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="Save File" Clicked="OnSaveFileMenuClicked">
                <MenuFlyoutItem.KeyboardAccelerators>
                    <KeyboardAccelerator Key="S" Modifiers="Windows" />
                </MenuFlyoutItem.KeyboardAccelerators>
            </MenuFlyoutItem>
            <MenuFlyoutItem Text="Save Project (All)" Clicked="OnSaveProjectMenuClicked" />
        </MenuBarItem>
    </ContentPage.MenuBarItems>
    <Grid RowDefinitions="*,24" ColumnDefinitions="40,280,*,360" Padding="0">
        <!-- Left Strap Icons -->
        <Border Grid.Row="0" Grid.Column="0" StrokeThickness="1" Stroke="LightGray" Padding="4">
            <VerticalStackLayout Spacing="12" HorizontalOptions="Center" VerticalOptions="Start">
                <Button Text="E" WidthRequest="28" HeightRequest="28" />
                <Button Text="S" WidthRequest="28" HeightRequest="28" />
                <Button Text="C" WidthRequest="28" HeightRequest="28" />
                <Button Text="X" WidthRequest="28" HeightRequest="28" />
            </VerticalStackLayout>
        </Border>

        <!-- Explorer Panel (Left) -->
        <Border Grid.Row="0" Grid.Column="1" StrokeThickness="1" Stroke="LightGray" Padding="8">
            <VerticalStackLayout Spacing="8">
                <Label Text="Explorer" FontAttributes="Bold" />
                <toolkit:TreeView x:Name="FileTree">
                    <toolkit:TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <Label Text="{Binding Name}">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer NumberOfTapsRequired="2" Tapped="OnFileDoubleTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                        </HierarchicalDataTemplate>
                    </toolkit:TreeView.ItemTemplate>
                </toolkit:TreeView>
            </VerticalStackLayout>
        </Border>

        <!-- Center Column (Editor over Terminal) -->
        <Grid Grid.Row="0" Grid.Column="2" RowDefinitions="*,220" ColumnDefinitions="*" Padding="0">
            <!-- Editor (Top) -->
            <Border Grid.Row="0" StrokeThickness="1" Stroke="LightGray" Padding="8">
                <Grid RowDefinitions="Auto,*" ColumnDefinitions="*">
                    <Label Grid.Row="0" Grid.Column="0" Text="Editor" FontAttributes="Bold" />
                    <Editor Grid.Row="1" Grid.Column="0" x:Name="EditorView" AutoSize="TextChanges" Placeholder="Open a file to start editing..." />
                </Grid>
            </Border>

            <!-- Terminal (Bottom) -->
            <Border Grid.Row="1" StrokeThickness="1" Stroke="LightGray" Padding="8">
                <Grid RowDefinitions="Auto,*" ColumnDefinitions="*" ColumnSpacing="8" RowSpacing="8">
                    <Label Grid.Row="0" Grid.Column="0" Text="Terminal" FontAttributes="Bold" />
                    <Editor Grid.Row="1" Grid.Column="0" x:Name="TerminalView"
                            FontFamily="Menlo"
                            AutoSize="Disabled"
                            IsSpellCheckEnabled="False"
                            IsTextPredictionEnabled="False"
                            TextChanged="OnTerminalTextChanged" />
                </Grid>
            </Border>
        </Grid>

        <!-- Right Panel: AI Chat -->
        <Border Grid.Row="0" Grid.Column="3" StrokeThickness="1" Stroke="LightGray" Padding="8">
            <VerticalStackLayout Spacing="8">
                <Label Text="AI Chat" FontAttributes="Bold" />
                <Label Text="Conversational agent will appear here." FontSize="12" TextColor="Gray" />
            </VerticalStackLayout>
        </Border>
        <!-- Bottom Status Bar -->
        <Border Grid.Row="1" Grid.ColumnSpan="4" StrokeThickness="1" Stroke="LightGray" Padding="4">
            <Label x:Name="StatusLabel" Text="Ready" />
        </Border>
    </Grid>
</ContentPage>
